# etok design

Technical documentation regarding the design of etok.

## Command lifecyle

The lifecycle of a command from the creation of a command resource (that is, a kubernetes resource of type `Init`, `Plan`, `Apply`, etc) right through to the invocation of the terraform command on the pod and its completion.

The design is necessarily complex in order to orchestrate the various components of etok.

[![](https://mermaid.ink/svg/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdHBhcnRpY2lwYW50IENsIGFzIENsaWVudFxuXHRwYXJ0aWNpcGFudCBDbyBhcyBDb21tYW5kIENvbnRyb2xsZXJcblx0cGFydGljaXBhbnQgVyBhcyBXb3Jrc3BhY2UgQ29udHJvbGxlclxuXHRwYXJ0aWNpcGFudCBBIGFzIEFkanVuY3QgQ29udGFpbmVyXG5cdHBhcnRpY2lwYW50IFQgYXMgVGVycmFmb3JtIENvbnRhaW5lclxuXHRDbC0-PkNsOiBDcmVhdGUgY29tbWFuZCByZXNvdXJjZVxuXHRDbC0tPj5XOiBUcmlnZ2VyIHJlY29uY2lsZVxuXHRsb29wIFF1ZXVlXG5cdFx0Vy0-Plc6IFNoaWZ0IGNvbW1hbmQgdG8gZnJvbnQgb2YgcXVldWVcblx0ZW5kXG5cdFctLT4-Q286IFRyaWdnZXIgcmVjb25jaWxlXG5cdENvLT4-Q286IFNldCBcImFjdGl2ZVwiIGNvbmRpdGlvblxuXHRwYXJcblx0Q28tLT4-QTogVHJpZ2dlciB3YXRjaFxuXHRcdEEtPj5BOiBQcmVwYXJlIHRlcnJhZm9ybVxuXHRcdE5vdGUgb3ZlciBBOiBFeHRyYWN0IGNvbmZpZ21hcCBkYXRhLCB3cml0ZSB0ZXJyYWZvcm0gc2NyaXB0XG5cdGFuZFxuXHRcdENvLS0-PkNsOiBUcmlnZ2VyIHdhdGNoXG5cdFx0Q2wtPj5DbDogU2V0IFwiYXR0YWNoZWRcIiBhbm5vdGF0aW9uXG5cdFx0Q2wtLT4-Q286IFRyaWdnZXIgcmVjb25jaWxlXG5cdFx0Q28tPj5DbzogU2V0IFwiYXR0YWNoZWRcIiBjb25kaXRpb25cblx0ZW5kXG5cblx0Q28tLT4-QTogVHJpZ2dlciB3YXRjaFxuXHRcblx0QS0tPj5UOiBUcmlnZ2VyIHNlbWFwaG9yZVxuXHRULT4-VDogUnVuIHRlcnJhZm9ybVxuXHRULS0-PkE6IFRyaWdnZXIgc2VtYXBob3JlXG5cdEEtPj5BOiBTZXQgXCJleGl0ZWRcIiBhbm5vdGF0aW9uXG5cdEEtLT4-Q286IFRyaWdnZXIgc2VtYXBob3JlXG5cdENvLT4-Q286IFNldCBcImV4aXRlZFwiIGNvbmRpdGlvblxuXHRDby0tPj5DbDogVHJpZ2dlciB3YXRjaFxuXHRDbC0-PkNsOiBFeGl0XG5cblxuXG5cdFx0XHRcdFx0IiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0)](https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic2VxdWVuY2VEaWFncmFtXG5cdHBhcnRpY2lwYW50IENsIGFzIENsaWVudFxuXHRwYXJ0aWNpcGFudCBDbyBhcyBDb21tYW5kIENvbnRyb2xsZXJcblx0cGFydGljaXBhbnQgVyBhcyBXb3Jrc3BhY2UgQ29udHJvbGxlclxuXHRwYXJ0aWNpcGFudCBBIGFzIEFkanVuY3QgQ29udGFpbmVyXG5cdHBhcnRpY2lwYW50IFQgYXMgVGVycmFmb3JtIENvbnRhaW5lclxuXHRDbC0-PkNsOiBDcmVhdGUgY29tbWFuZCByZXNvdXJjZVxuXHRDbC0tPj5XOiBUcmlnZ2VyIHJlY29uY2lsZVxuXHRsb29wIFF1ZXVlXG5cdFx0Vy0-Plc6IFNoaWZ0IGNvbW1hbmQgdG8gZnJvbnQgb2YgcXVldWVcblx0ZW5kXG5cdFctLT4-Q286IFRyaWdnZXIgcmVjb25jaWxlXG5cdENvLT4-Q286IFNldCBcImFjdGl2ZVwiIGNvbmRpdGlvblxuXHRwYXJcblx0Q28tLT4-QTogVHJpZ2dlciB3YXRjaFxuXHRcdEEtPj5BOiBQcmVwYXJlIHRlcnJhZm9ybVxuXHRcdE5vdGUgb3ZlciBBOiBFeHRyYWN0IGNvbmZpZ21hcCBkYXRhLCB3cml0ZSB0ZXJyYWZvcm0gc2NyaXB0XG5cdGFuZFxuXHRcdENvLS0-PkNsOiBUcmlnZ2VyIHdhdGNoXG5cdFx0Q2wtPj5DbDogU2V0IFwiYXR0YWNoZWRcIiBhbm5vdGF0aW9uXG5cdFx0Q2wtLT4-Q286IFRyaWdnZXIgcmVjb25jaWxlXG5cdFx0Q28tPj5DbzogU2V0IFwiYXR0YWNoZWRcIiBjb25kaXRpb25cblx0ZW5kXG5cblx0Q28tLT4-QTogVHJpZ2dlciB3YXRjaFxuXHRcblx0QS0tPj5UOiBUcmlnZ2VyIHNlbWFwaG9yZVxuXHRULT4-VDogUnVuIHRlcnJhZm9ybVxuXHRULS0-PkE6IFRyaWdnZXIgc2VtYXBob3JlXG5cdEEtPj5BOiBTZXQgXCJleGl0ZWRcIiBhbm5vdGF0aW9uXG5cdEEtLT4-Q286IFRyaWdnZXIgc2VtYXBob3JlXG5cdENvLT4-Q286IFNldCBcImV4aXRlZFwiIGNvbmRpdGlvblxuXHRDby0tPj5DbDogVHJpZ2dlciB3YXRjaFxuXHRDbC0-PkNsOiBFeGl0XG5cblxuXG5cdFx0XHRcdFx0IiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0)

